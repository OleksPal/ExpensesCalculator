@using Newtonsoft.Json
@model ExpensesCalculator.Models.DayExpensesViewModel

@{
    ViewData["Title"] = "Details";
}

<script>
    function myFunction(checkId) {
        var list = @Html.Raw(JsonConvert.SerializeObject(@Model.Checks));

        var ul = document.getElementById("itemsList");
        ul.innerHTML = "";

        current_url = window.location.href;
        url_object = new URL(current_url);

        protocol = url_object.protocol;
        domain = url_object.hostname;
        port = url_object.port;

        for (let i = 0; i < list[checkId].Items.length; i++) {
            var itemId = list[checkId].Items[i].Id;

            var a = document.createElement("a");
            a.textContent = "Edit";
            a.setAttribute('href', `${protocol}//${domain}:${port}/Items/Edit/${itemId}?checkid=${checkId}`);

            var a2 = document.createElement("a");
            a2.textContent = "Delete";
            a2.setAttribute('href', `${protocol}//${domain}:${port}/Items/Delete/${itemId}?checkid=${checkId}`);

            var li = document.createElement("li");
            li.textContent = list[checkId].Items[i].Name + " " + list[checkId].Items[i].Description + " ";            
            
            var label = document.createElement("label");
            label.textContent = "\xa0|\xa0";

            li.appendChild(a);
            li.appendChild(label);
            li.appendChild(a2);

            document.getElementById("itemsList").appendChild(li);
        }      
    }
</script>

<h1>Details</h1>

<div>
    <h4>DayExpenses</h4>
    <hr />

    <div style="float:left;width:30%;">
        <dl class="row">
            <dt class="col-sm">
                @Html.DisplayNameFor(model => model.Date)
            </dt>
            <dd class="col-sm">
                @Html.DisplayFor(model => model.Date)
            </dd>
        </dl>
        @for (int i = 0; i < Model.Checks.Count; i++)
        {
            <dl class="row">
                <dt class="col-sm">
                    <label style="font-weight:bold">Location: @Model.Checks[i].Location</label><br />
                    <label style="font-weight:bold">Sum: @Model.Checks[i].Sum</label>
                </dt>
                <dd class="col-sm">
                    <a asp-controller="Checks" asp-action="Edit" asp-route-id="@Model.Checks[i].Id">Edit</a> |
                    <a class="link-button" role="button" onclick="myFunction(@i)">Show items</a>
                </dd>
            </dl>
        }
        <div>
            <a asp-controller="Checks" asp-action="Create" asp-route-dayexpensesid="@Model.DayExpensesId">Create check</a> |
            <a asp-action="Index">Back to List</a>
        </div>
    </div>
    <div style="float:right;width:40%;">
        <label style="font-weight:bold">List of items</label>
        <ul id="itemsList"></ul>
    </div> 
</div>
<div style="clear:both;"></div>
